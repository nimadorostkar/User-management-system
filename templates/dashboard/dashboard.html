{% load static %}
<!doctype html>
<html lang="en">

<!-- Mirrored from themesbrand.com/minible/layouts/horizontal/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 21 Jan 2021 11:50:25 GMT -->
<head>
        <meta charset="utf-8" />
        <title> Crop | Dashboard </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
        <meta content="crop user management system" name="nima dorostkar" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="{% static 'dashboard/images/logo.png' %}">

        <!-- Bootstrap Css -->
        <link href="{% static 'dashboard/css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />
        <!-- Icons Css -->
        <link href="{% static 'dashboard/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        <link href="{% static 'dashboard/css/app.min.css' %}" id="app-style" rel="stylesheet" type="text/css" />

        <!-- nimaaaaaaa -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="{% static 'dashboard/css/add_font.css' %}" rel="stylesheet" type="text/css" />


        <style>
            .tabcontent {
                display: none;
                padding: 6px 12px;
                border: 1px solid #ccc;
                border-top: none;
            }
            .tabcontent {
                animation: fadeEffect 1s; /* Fading effect takes 1 second */
            }
            /* Go from zero to full opacity */
            @keyframes fadeEffect {
                from {opacity: 0;}
                to {opacity: 1;}
            }
        </style>

    </head>

    <!-- <body> -->
    <body data-layout="horizontal" data-topbar="colored">




        <!-- Begin page -->
        <div id="layout-wrapper">
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="{% url 'dashboard' %}" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="{% static 'account/img/logo.png' %}" alt="" height="40">
                                </span>
                                <span class="logo-lg">
                                    <img src="{% static 'account/img/logo.png' %}" alt="" height="65">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-16 d-lg-none header-item waves-effect waves-light" data-toggle="collapse" data-target="#topnav-menu-content">
                            <i class="fa fa-fw fa-bars"></i>
                        </button>

                    </div>

                    <div class="d-flex">

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="{{ user.profile.user_photo.url }}" alt="Header Avatar">
                                <span class="d-none d-xl-inline-block ml-1 font-weight-medium font-size-18">{{ user.username }}</span>
                                <i class="uil-angle-down d-none d-xl-inline-block font-size-18"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="{% url 'account_logout' %}"><i class="uil uil-sign-out-alt font-size-18 align-middle mr-1 text-muted"></i> <span class="align-middle">Sign out</span></a>
                                {% if request.user.is_superuser %}
                                <a class="dropdown-item" href="{% url 'admin:index' %}"><i class="fa fa-user"></i> <span class="align-middle">Admin panel</span></a>
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </div>

                <div class="container-fluid">
                    <div class="topnav">
                        <nav class="navbar navbar-light navbar-expand-lg topnav-menu">
                            <div class="collapse navbar-collapse" id="topnav-menu-content">
                                <ul class="navbar-nav">
                                    <li class="nav-item">
                                        <a class="nav-link" onclick="openTab(event, '1')" id="defaultOpen">
                                            <i class="fa fa-file-text-o"></i>  اعلانات به کاربر
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" onclick="openTab(event, '2')">
                                            <i class="fa fa-address-card-o"></i>  مشخصات
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" onclick="openTab(event, '3')">
                                            <i class="fa fa-money"></i>  بارگذاری فیش پرداخت

                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" onclick="openTab(event, '4')">
                                            <i class="fa fa-download"></i>  دانلود فایل
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </nav>
                    </div>
                </div>

            </header>


            <!-- Investment Overview -->
            <div id="1" class="tabcontent">
                <div class="main-content">
                    <div class="page-content">
                        <div class="container-fluid">
                            <!-- start page title -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="page-title-box d-flex align-items-center justify-content-between">
                                        <h4 class="mb-0"> اعلانات به کاربر </h4>

                                        <div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item">Dashboard</li>
                                                <li class="breadcrumb-item active"> اعلانات به کاربر </li>
                                            </ol>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- end page title -->


                            <br><br>
                          {% for Notice in notices %}
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">
                                             <h4 class="card-title mb-4">{{ Notice.title }}</h4>
                                             <div class="table-responsive">
                                                <p style="text-align:right; direction:rtl" class="text-muted mb-0">{{ Notice.content|linebreaks }}</p>
                                                <br>
                                                <p  style="text-align:left"> <small> {{ Notice.updated_on }} </small> </p>
                                              </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                          {% endfor %}
                            <!-- end row -->

                        </div> <!-- container-fluid -->
                    </div>
                    <!-- End Page-content -->




                    <footer class="footer">
                        <div class="container-fluid">
                            <div class="row">
                                <div style="text-align:left" class="col-sm-6">
                                    <script>document.write(new Date().getFullYear())</script> © All Rights Reserved
                                </div>
                                <div class="col-sm-6">
                                    <div class="text-sm-right d-none d-sm-block">
                                        Crop with <i class="fas fa-heart"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
                <!-- end main content-->
            </div>

            <!-- Portfolio Insights -->
            <div id="2" class="tabcontent">
                <div class="main-content">
                    <div class="page-content">
                        <div class="container-fluid">
                            <!-- start page title -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="page-title-box d-flex align-items-center justify-content-between">
                                        <h4 class="mb-0"> مشخصات  </h4>

                                        <div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item">Dashboard</li>
                                                <li class="breadcrumb-item active"> مشخصات  </li>
                                            </ol>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- end page title -->

                            <div class="row">

                              <div class="col-md-4 col-sm-12">
                                  <div class="card">
                                      <div class="card-body">
                                          <div>
                                            <dl>
                                              <dt style="color:#f56f11;"> <small> نام کاربری </small> </dt>
                                              <dd style="text-align:center"> {{ user.username }} </dd>
                                              <dt style="color:#f56f11;"><small> نام </small> </dt>
                                              <dd style="text-align:center"> {{ user.first_name }} </dd>
                                              <dt style="color:#f56f11;"> <small> نام خانوادگی</small> </dt>
                                              <dd style="text-align:center"> {{ user.last_name }} </dd>
                                              <dt style="color:#f56f11;"> <small> نام پدر </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.father_name }} </dd>
                                            </dl>
                                          </div>
                                      </div>
                                  </div>
                              </div> <!-- end col-->
                              <div class="col-md-4 col-sm-12">
                                  <div class="card">
                                      <div class="card-body">
                                          <div>
                                            <dl>
                                              <dt style="color:#f56f11;"> <small> E-mail </small> </dt>
                                              <dd style="text-align:center"> {{ user.email }} </dd>
                                              <dt style="color:#f56f11;"><small> شماره شناسنامه </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.identity_number }} </dd>
                                              <dt style="color:#f56f11;"> <small> کد ملی </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.national_code }} </dd>
                                              <dt style="color:#f56f11;"> <small>  شماره تماس  </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.phone }} </dd>
                                            </dl>
                                          </div>
                                      </div>
                                  </div>
                              </div> <!-- end col-->
                              <div class="col-md-4 col-sm-12">
                                  <div class="card">
                                      <div class="card-body">
                                          <div>
                                            <dl>
                                              <dt style="color:#f56f11;"> <small> آدرس </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.address }} </dd>
                                              <dt style="color:#f56f11;"><small>  نام بانک  </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.bank_name }} </dd>
                                              <dt style="color:#f56f11;"> <small> نام صاحب حساب </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.account_holder }} </dd>
                                              <dt style="color:#f56f11;"> <small> شماره کارت </small> </dt>
                                              <dd style="text-align:center"> {{ user.profile.cardـnumber }} </dd>
                                            </dl>
                                          </div>
                                      </div>
                                  </div>
                              </div> <!-- end col-->

                            </div>

                            <div class="row">
                                <div class="col-md-4 col-sm-12">
                                    <div class="card">
                                      <div align="center">
                                        <p style="color:#f56f11;"> تصویر کاربر </p>
                                        <img  style="border-radius:18px;" width="60%" src="{{ user.profile.user_photo.url }}" >
                                        <p>  </p>
                                      </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <div class="card">
                                      <div align="center">
                                        <p style="color:#f56f11;"> امضاء  </p>
                                        <img  style="border-radius:18px;" width="60%" src="{{ user.profile.signature.url }}" >
                                        <p>  </p>
                                      </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <div class="card">
                                      <div align="center">
                                        <p style="color:#f56f11;"> عکس پرسنلی ۳*۴  </p>
                                        <img  style="border-radius:18px;" width="60%" src="{{ user.profile.personalـphoto.url }}" >
                                        <p>  </p>
                                      </div>
                                    </div>
                                </div>
                            </div> <!-- end row-->


                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">

                                            <button type="button" class="btn btn-success btn-block" data-toggle="modal" data-target="#myModal">
                                                <i class="fa fa-plus"></i> &nbsp; ویرایش اطلاعات
                                            </button>

                                            <!-- Modal -->
                                            <div id="myModal" class="modal fade" role="dialog">
                                                <div class="modal-dialog modal-dialog-centered modal-lg">
                                                    <!-- Modal content-->
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title"> تکمیل مشخصات </h4>
                                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                        </div>
                                                        <div style="text-align:right; direction:rtl" class="modal-body">
                                                             <form method="post" enctype="multipart/form-data">
                                                                  {% csrf_token %}
                                                                  {{ user_form.as_p }}
                                                                  {{ profile_form.as_p }}
                                                                  <div class="row mt-4 justify-content-center">
                                                                      <button type="submit" class="btn btn-primary w-md"> ذخیره </button>
                                                                  </div>
                                                              </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-danger" data-dismiss="modal"> بستن </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end row -->


                            <footer class="footer">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div style="text-align:left" class="col-sm-6">
                                            <script>document.write(new Date().getFullYear())</script> © All Rights Reserved
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="text-sm-right d-none d-sm-block">
                                                Crop with <i class="fas fa-heart"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Recommendations -->
            <div id="3" class="tabcontent">
                <div class="main-content">
                    <div class="page-content">
                        <div class="container-fluid">
                            <!-- start page title -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="page-title-box d-flex align-items-center justify-content-between">
                                        <h4 class="mb-0"> بارگذاری فیش پرداخت </h4>

                                        <div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item">Dashboard</li>
                                                <li class="breadcrumb-item active"> بارگذاری فیش پرداخت </li>
                                            </ol>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- end page title -->



                              <div class="row">
                                {% for Payment in payment %}
                                  <div class="col-md-4 col-sm-12">
                                      <div class="card">
                                        <div align="center">
                                          <br>
                                          <p style="color:#f56f11;"> {{ Payment.updated_on }}  </p>
                                          <img  style="border-radius:18px;" width="60%" src="{{ Payment.photo.url }}" >
                                          <p> {{ Payment.descriptions }}  </p>
                                        </div>
                                      </div>
                                  </div>
                                {% endfor %}
                             </div> <!-- end row-->


                             <div class="row">
                                 <div class="col-lg-12">
                                     <div class="card">
                                         <div class="card-body">
                                           <a class="btn btn-success btn-block" href="{% url 'payment' %}" target="_blank"> <i class="fa fa-plus"></i> &nbsp; بارگذاری فیش پرداخت </a>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                             <!-- end row -->





                            <footer class="footer">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div style="text-align:left" class="col-sm-6">
                                            <script>document.write(new Date().getFullYear())</script> © All Rights Reserved
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="text-sm-right d-none d-sm-block">
                                                Crop with <i class="fas fa-heart"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Investment Overview -->
            <div id="4" class="tabcontent">
                <div class="main-content">
                    <div class="page-content">
                        <div class="container-fluid">
                            <!-- start page title -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="page-title-box d-flex align-items-center justify-content-between">
                                        <h4 class="mb-0"> دانلود فایل </h4>

                                        <div class="page-title-right">
                                            <ol class="breadcrumb m-0">
                                                <li class="breadcrumb-item">Dashboard</li>
                                                <li class="breadcrumb-item active"> دانلود فایل </li>
                                            </ol>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- end page title -->


                            <div class="row">
                              {% for Submitted_files in submitted_files %}
                                <div class="col-md-4 col-sm-12">
                                    <div class="card">
                                      <div align="center">
                                        <br>
                                        <p> {{ Submitted_files.title }}  </p>
                                        <a href="{{ Submitted_files.file.url }}" download><button class="btn btn-outline-warning mr-3">Download</button></a>
                                        <hr> <p style="color:#f56f11;"> {{ Submitted_files.updated_on }}  </p>
                                      </div>
                                    </div>
                                </div>
                              {% endfor %}
                           </div> <!-- end row-->



                        </div> <!-- container-fluid -->
                    </div>
                    <!-- End Page-content -->




                    <footer class="footer">
                        <div class="container-fluid">
                            <div class="row">
                                <div style="text-align:left" class="col-sm-6">
                                    <script>document.write(new Date().getFullYear())</script> © All Rights Reserved
                                </div>
                                <div class="col-sm-6">
                                    <div class="text-sm-right d-none d-sm-block">
                                        Crop with <i class="fas fa-heart"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
                <!-- end main content-->
            </div>

        </div>
        <!-- END layout-wrapper -->

        <!-- JAVASCRIPT -->
        <script src="{% static 'dashboard/libs/jquery/jquery.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/metismenu/metisMenu.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/simplebar/simplebar.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/node-waves/waves.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/waypoints/lib/jquery.waypoints.min.js' %}"></script>
        <script src="{% static 'dashboard/libs/jquery.counterup/jquery.counterup.min.js' %}"></script>

        <!-- apexcharts -->
        <script src="{% static 'dashboard/libs/apexcharts/apexcharts.min.js' %}"></script>

        <script src="{% static 'dashboard/js/pages/dashboard.init.js' %}"></script>

        <script src="{% static 'dashboard/js/app.js' %}"></script>

        <!--  Script for Updating the LTP, PNL and Net Change data in holdings table by fetching data from backend -->
        <script>
            function updateData(data) {
                stockdata = data["StockData"];
                currentValue = parseFloat(data["CurrentValue"]).toFixed(2);
                unrealizedPNL = parseFloat(data["UnrealizedPNL"]).toFixed(2);
                growth = parseFloat(data["Growth"]).toFixed(2);
                var tableRows = document.getElementById("portfolio-table").tBodies[0].rows;
                for (var i = 0; i < tableRows.length; i++) {
                    var tableData = tableRows[i].getElementsByTagName('td');
                    tableData[3].innerHTML = "$ " + stockdata[tableRows[i].id]["LastTradingPrice"].toFixed(2);
                    if (stockdata[tableRows[i].id]["PNL"] > 0) {
                        tableData[5].style.color = "#34c38f";
                        tableData[6].style.color = "#34c38f";
                        tableData[5].innerHTML = "+ $ " + stockdata[tableRows[i].id]["PNL"].toFixed(2);
                        tableData[6].innerHTML = "+ " + stockdata[tableRows[i].id]["NetChange"].toFixed(2) + " %";
                    } else {
                        tableData[5].style.color = "#f46a6a";
                        tableData[6].style.color = "#f46a6a";
                        tableData[5].innerHTML = "- $ " + Math.abs(stockdata[tableRows[i].id]["PNL"].toFixed(2));
                        tableData[6].innerHTML = "- " + Math.abs(stockdata[tableRows[i].id]["NetChange"].toFixed(2)) + " %";
                    }
                }
                var currentValueHeading = document.getElementById("current-value").getElementsByTagName("span")[0];
                currentValueHeading.innerHTML = currentValue;
                var unrealizedPNLHeading = document.getElementById("unrealized-pnl");
                var growthHeading = document.getElementById("growth");

                if (unrealizedPNL > 0) {
                    unrealizedPNLHeading.style.color = ":#34c38f";
                    growthHeading.style.color = ":#34c38f";
                    unrealizedPNLHeading.getElementsByTagName("span")[0].innerHTML = "+ $ " + Math.abs(unrealizedPNL);
                    growthHeading.getElementsByTagName("span")[0].innerHTML = "+ " + Math.abs(growth);
                } else {
                    unrealizedPNLHeading.style.color = "#f46a6a";
                    growthHeading.style.color = "#f46a6a";
                    unrealizedPNLHeading.getElementsByTagName("span")[0].innerHTML = "- $ " + Math.abs(unrealizedPNL);
                    growthHeading.getElementsByTagName("span")[0].innerHTML = "- " + Math.abs(growth);
                }
            }

            function getUpdatedValues() {
                $.ajax({
                    type: "GET",
                    url: "/update-prices",
                    dataType: "json",
                    success: function(data) {
                        if (data.hasOwnProperty('Error')) {
                            alert('Error at backend\n' + "Message: " + data['Error']);
                        } else {
                            updateData(data);
                        }
                    }
                });
            }

            getUpdatedValues();
            var callUpdateFunction = setInterval(getUpdatedValues(), 1000 * 60 * 5); // where X is your every X minutes
        </script>

        <!-- Script for showing the company's basic financial information once view details button is clicked -->
        <script>
            function printFinancials(symbol, data) {
                var row = document.getElementById("financials-" + symbol);
                var htmlcontent = `
                    <div class="col-4">
                        <table class='table borderless'>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Sector</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ data['Sector'] }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Book Value</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['BookValue']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">PE Ratio</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['PERatio']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">PB Ratio</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['PriceToBookRatio']).toFixed(2) }</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-4">
                        <table class='table borderless'>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Profit Margin</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['ProfitMargin']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Operating Margin TTM</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['OperatingMarginTTM']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Return on Assets TTM</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['ReturnOnAssetsTTM']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Return on Equity TTM</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['ReturnOnEquityTTM']).toFixed(2) }</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-4">
                        <table class='table borderless'>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">52 Week Range</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">$ ${ parseFloat(data['52WeekLow']).toFixed(2) } - $ ${ parseFloat(data['52WeekHigh']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">Beta</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['Beta']).toFixed(2) }</td>
                            </tr>
                            <tr>
                                <td style="font-size: 16px; border-top: none;">EV to EBITDA</td>
                                <td class="font-weight-bold" style="font-size: 16px; border-top: none;">${ parseFloat(data['EVToEBITDA']).toFixed(2) }</td>
                            </tr>
                        </table>
                    </div>
                `;

                row.innerHTML = htmlcontent;
            }

            function getFinancials(symbol) {
                $.ajax({
                    type: "GET",
                    url: "/get-financials",
                    data: {
                        "symbol": symbol
                    },
                    dataType: "json",
                    success: function(data) {
                        if (data.hasOwnProperty('Error')) {
                            alert('Error at backend for getFinancials\n' + "Message: " + data['Error']);
                            var active = false;
                            var timer = setTimeout(() => { getFinancials(symbol); clearTimeout(timer); }, 1000 * 10 * 1);
                        } else {
                            printFinancials(symbol, data["financials"]);
                        }
                    }
                });
            }
        </script>

        <!-- Script for submitting the form with AJAX -->
        <script>
            function addStockHoldingResult(data) {
                if (data === "Success") {
                    $('#myModal').modal('toggle');
                    alert("Stock Holding successfully added to your portfolio");
                    location.reload();
                } else {
                    alert("Error adding the stock holding\n" + "Message: " + data);
                }
            }

            $("#add-holding-form").submit(function(e) {
                e.preventDefault(); // avoid to execute the actual submit of the form.
                var form = $(this);
                var url = form.attr('action');
                $.ajax({
                    type: "POST",
                    url: url,
                    data: form.serialize(),
                    success: function(data) { addStockHoldingResult(data) }
                });
            });
        </script>

        <!-- Script for getting the list of companies for showing it in the add new holding dropdown -->
        <!-- This will be called only once -->
        <script>
            function processData(data) {
                var datalist = document.getElementById("company");
                for (var i = 0; i < data.length; i++) {
                    var option = document.createElement("option");
                    option.innerHTML = data[i][1] + " &nbsp;(" + data[i][0] + ")";
                    datalist.append(option);
                }
            }

            $(document).ready(function() {
               $.ajax({
                    type: "GET",
                    url: "/company-list",
                    dataType: "json",
                    success: function(data) { processData(data["data"]); }
                });
            });
        </script>

        <!-- Script for getting the date value -->
        <script>
            function getDate() {
                var today = new Date();
                var dd = today.getDate();
                var mm = today.getMonth()+1; //January is 0!
                var yyyy = today.getFullYear();

                if(dd<10) {
                    dd = '0'+dd
                }

                if(mm<10) {
                    mm = '0'+mm
                }

                today = yyyy + '-' + mm + '-' + dd;
                document.getElementById("example-date-input").value = today;
                document.getElementById("example-date-input").max = today;
            }

            $(document).ready( function () {
                getDate();
            });
        </script>

        <!-- Script for working of navbar options -->
        <script>
            function getPortfolioInsights() {
                $.ajax({
                    type: "GET",
                    url: "/get-portfolio-insights",
                    dataType: "json",
                    success: function(data) {
                        if (data.hasOwnProperty('Error')) {
                            alert('Error at backend\n' + "Message: " + data['Error']);
                            getPortfolioInsights();
                        } else {
                            var betaElement = document.getElementById("portfolio-beta");
                            var betaElementTxt = document.getElementById("portfolio-beta-text");
                            betaElement.innerHTML = parseFloat(data["PortfolioBeta"]).toFixed(2);
                            betaElementTxt.innerHTML = `Your portfolio moves by a factor of ${ parseFloat(data["PortfolioBeta"]).toFixed(2) } in the direction of market swing`;
                            var peElement = document.getElementById("portfolio-pe");
                            peElement.innerHTML = parseFloat(data["PortfolioPE"]).toFixed(2);
                        }
                    }
                });
            }

            function openTab(evt, tabName) {
                // Declare all variables
                var i, tabcontent, tablinks;
                // Get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("nav-link");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(tabName).style.display = "block";
                evt.currentTarget.className += " active";

                if (tabName === "portfolio-insights") {
                    getPortfolioInsights();
                }
            }
            document.getElementById("defaultOpen").click();
        </script>

        <!-- Donut Charts -->
        <script>
            function generateRandomColors(length) {
                var colors = [];
                for (let i = 0; i < length; i++) {
                    var randomColor = Math.floor(Math.random()*16777215).toString(16);
                    colors.push("#" + randomColor);
                }
                return colors;
            }

            var accounts = {
                'data': [100],
                'labels': ['equity']
            };

            var sectorsdata = {{ sectors.0 }};
            var sectorslabels = JSON.parse('{{ sectors.1 }}'.replace(new RegExp("&"+"#"+"x27;", "g"), '"'));
            var sectors = {
                'data': sectorsdata,
                'labels': sectorslabels
            };

            var stocksdata = {{ stocks.0 }};
            var stockslabels = JSON.parse('{{ stocks.1 }}'.replace(new RegExp("&"+"#"+"x27;", "g"), '"'));
            var stocks = {
                'data': stocksdata,
                'labels': stockslabels
            };

            var accountChartConfig = {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: accounts['data'],
                        backgroundColor: generateRandomColors(accounts['data'].length),
                    }],
                    // These labels appear in the legend and in the tooltips when hovering different arcs
                    labels: accounts['labels']
                },
                options: {
                    responsive: true,
                    legend: {
                    position: 'right',
                    },
                    animation: {
                    animateScale: true,
                    animateRotate: true
                    }
                }
            };
            var sectorChartConfig = {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: sectors['data'],
                        backgroundColor: generateRandomColors(sectors['data'].length),
                    }],
                    // These labels appear in the legend and in the tooltips when hovering different arcs
                    labels: sectors['labels']
                },
                options: {
                    responsive: true,
                    legend: {
                    position: 'right',
                    },
                    animation: {
                    animateScale: true,
                    animateRotate: true
                    }
                }
            };
            var stockChartConfig = {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: stocks['data'],
                        backgroundColor: generateRandomColors(stocks['data'].length),
                    }],
                    // These labels appear in the legend and in the tooltips when hovering different arcs
                    labels: stocks['labels']
                },
                options: {
                    responsive: true,
                    legend: {
                    position: 'right',
                    },
                    animation: {
                    animateScale: true,
                    animateRotate: true
                    }
                }
            };
            window.onload = function() {
                var ctx1 = document.getElementById('account-chart-container').getContext('2d');
                window.myDoughnut1 = new Chart(ctx1, accountChartConfig);
                var ctx2 = document.getElementById('sector-chart-container').getContext('2d');
                window.myDoughnut2 = new Chart(ctx2, sectorChartConfig);
                var ctx3 = document.getElementById('stock-chart-container').getContext('2d');
                window.myDoughnut3 = new Chart(ctx3, stockChartConfig);
            };
        </script>
    </body>


<!-- Mirrored from themesbrand.com/minible/layouts/horizontal/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 21 Jan 2021 11:52:26 GMT -->
</html>
